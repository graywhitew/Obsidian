Инварианты - это то, что должно быть истинным всякий раз, когда мы заканчиваем операцию. Является реализации проверки бизнес-процессов.

Поддерживание инвариантов усложняется когда вводится идея параллелизма(concurrency). Обычно мы решаем эту проблему, применяя блокировки(locks) к нашим базам данных. Это предотвращает одновременное выполнение двух операций в одной сроке или одной таблице.

Но блокировать всю БД при всякой операции бизнес-логики не представляется возможным.
Паттерн "Агрегат" как раз и помогает разрешить эту напряженность. Агрегат - это просто объект предметной области, который содержит другие её объекты и позволяет рассматривать всю коллекцию как единое целое.
Единственный способ изменять объекты внутри агрегата -загружать его целиком и вызывать методы самого агрегата. Агрегат является гарантом того, что каждая операция будет заканчиваться как положено.
![[Pasted image 20241128230207.png]]
![[Pasted image 20241128230215.png]]
![[Pasted image 20241128230242.png]]
Один агрегат - один репозиторий.