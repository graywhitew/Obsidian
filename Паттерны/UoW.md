Паттерн "UoW"(Unit of Work - "единица работы") выполняет связывание паттернов "Репозиторий" и "Сервисный слой".
Если паттерн "Репозиторий" - это абстракция идеи постоянного хранения данных, то паттерн "UoW" - это абстракция идеи атомарных операций. Он позволяет окончательно устранить связанность сервисного слоя со слоем данных.
Служба сервисного слоя сотрудничает с паттерном UoW, но ни сама функция службы, ни Flask теперь не нуждаются в непосредственном обмене с базой данных.
Паттерн применяется с помощью контекстного менеджера.
![[Pasted image 20241128222522.png]]
![[Pasted image 20241128222529.png]]
Теперь 
![[Pasted image 20241128222636.png]]
Паттерн UoW действует как единая точка входа в систему постоянного хранения данных и отслеживает загрузку объектов и их последнее состояние.
Это даёт нам три полезные вещи:
- Стабильный снимок базы данных для работы, так что объекты, которые мы используем, не меняются на полпути;
- способ сохранять все изменения сразу, благодаря чему мы не окажемся в состоянии несогласованности, если что то пойдёт не так;
- простой API для обязанностей по обеспечению постоянства данных и удобное место для получения репозитория.
![[Pasted image 20241128223332.png]]
![[Pasted image 20241128223347.png]]
![[Pasted image 20241128223355.png]]
![[Pasted image 20241128223403.png]]
![[Pasted image 20241128223537.png]]
![[Pasted image 20241128223527.png]]
![[Pasted image 20241128223430.png]]
Это позволяет переписать реализацию сервисного слоя:
![[Pasted image 20241128223618.png]]
![[Pasted image 20241128223628.png]]
![[Pasted image 20241128223847.png]]